<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris SKB Muara Badak</title>

<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
.hidden{display:none}
header{background:#1e40af;color:#fff;padding:15px;display:flex;align-items:center}
header img{height:45px;margin-right:15px}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);margin-bottom:20px}
.menu{display:flex;gap:15px;flex-wrap:wrap;margin-bottom:20px}
button{padding:10px 15px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.masuk{background:#2563eb;color:#fff}
.keluar{background:#dc2626;color:#fff}
.simpan{background:#16a34a;color:#fff}
input,select,textarea{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#e5e7eb}
#loginBox{max-width:420px;margin:90px auto;background:white;padding:30px;border-radius:12px;text-align:center}
#loginBox img{height:80px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
<img src="logo.png">
<h3>Login Inventaris</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button class="simpan" onclick="login()">Masuk</button>
</div>

<div id="app" class="hidden">
<header>
<img src="logo.png">
<h2>Inventaris SKB Muara Badak</h2>
</header>

<div class="container">

<!-- MENU -->
<div class="menu">
<button class="masuk" onclick="showForm('masuk')">➕ Barang Masuk</button>
<button class="keluar" onclick="showForm('keluar')">➖ Barang Keluar</button>
</div>

<!-- FORM MASUK -->
<div class="card hidden" id="formMasuk">
<h3>Barang Masuk</h3>
<input type="date" id="mTgl">
<input id="mNama" placeholder="Nama Barang">
<input type="number" id="mJumlah" placeholder="Jumlah">
<select id="mDana">
<option>BOSKAB 1</option>
<option>BOSKAB 2</option>
<option>BOP 1</option>
<option>BOP 2</option>
<option>Dana Lainnya</option>
</select>
<textarea id="mKet" placeholder="Keterangan"></textarea>
<button class="simpan" onclick="simpanMasuk()">Simpan</button>
</div>

<!-- FORM KELUAR -->
<div class="card hidden" id="formKeluar">
<h3>Barang Keluar</h3>
<input type="date" id="kTgl">
<input id="kNama" placeholder="Nama Barang">
<input type="number" id="kJumlah" placeholder="Jumlah">
<select id="kDana">
<option>BOSKAB 1</option>
<option>BOSKAB 2</option>
<option>BOP 1</option>
<option>BOP 2</option>
<option>Dana Lainnya</option>
</select>
<textarea id="kKet" placeholder="Keterangan"></textarea>
<button class="simpan" onclick="simpanKeluar()">Simpan</button>
</div>

<!-- DATA -->
<div class="card">
<h3>Data Inventaris</h3>
<table>
<thead>
<tr>
<th>Tanggal</th><th>Barang</th><th>Jenis</th>
<th>Jumlah</th><th>Sisa</th><th>Dana</th><th>Keterangan</th>
</tr>
</thead>
<tbody id="tabel"></tbody>
</table>
</div>

<!-- STOK -->
<div class="card">
<h3>Sisa Barang per Barang</h3>
<table>
<thead><tr><th>Barang</th><th>Masuk</th><th>Keluar</th><th>Sisa</th></tr></thead>
<tbody id="stokBarang"></tbody>
</table>
</div>

<!-- DOWNLOAD -->
<div class="card">
<h3>Download Laporan</h3>
<select id="filterDana">
<option>BOSKAB 1</option>
<option>BOSKAB 2</option>
<option>BOP 1</option>
<option>BOP 2</option>
<option>Dana Lainnya</option>
</select>
<label>Dari</label>
<input type="date" id="tglAwal">
<label>Sampai</label>
<input type="date" id="tglAkhir">
<button class="simpan" onclick="downloadCSV()">Download CSV</button>
</div>

</div>
</div>

<script>
const USERS={admin:'12345',operator:'12345'};
let data=JSON.parse(localStorage.getItem('inventaris'))||[];

function login(){
if(USERS[user.value]===pass.value){
loginBox.style.display='none';
app.classList.remove('hidden');
tampil();
}else alert('Login salah');
}

function showForm(f){
formMasuk.classList.add('hidden');
formKeluar.classList.add('hidden');
if(f==='masuk')formMasuk.classList.remove('hidden');
if(f==='keluar')formKeluar.classList.remove('hidden');
}

function simpanMasuk(){
data.push({
tanggal:mTgl.value,
barang:mNama.value,
jenis:'Masuk',
jumlah:+mJumlah.value,
dana:mDana.value,
ket:mKet.value
});
simpan();
}

function simpanKeluar(){
data.push({
tanggal:kTgl.value,
barang:kNama.value,
jenis:'Keluar',
jumlah:+kJumlah.value,
dana:kDana.value,
ket:kKet.value
});
simpan();
}

function simpan(){
localStorage.setItem('inventaris',JSON.stringify(data));
tampil();
}

function tampil(){
let stok={},html='';
data.forEach(d=>{
if(!stok[d.barang])stok[d.barang]={m:0,k:0};
d.jenis==='Masuk'?stok[d.barang].m+=d.jumlah:stok[d.barang].k+=d.jumlah;
let sisa=stok[d.barang].m-stok[d.barang].k;
html+=`<tr><td>${d.tanggal}</td><td>${d.barang}</td><td>${d.jenis}</td><td>${d.jumlah}</td><td>${sisa}</td><td>${d.dana}</td><td>${d.ket}</td></tr>`;
});
tabel.innerHTML=html;

let sb='';
for(let b in stok){
sb+=`<tr><td>${b}</td><td>${stok[b].m}</td><td>${stok[b].k}</td><td>${stok[b].m-stok[b].k}</td></tr>`;
}
stokBarang.innerHTML=sb;
}

function downloadCSV(){
let hasil=data.filter(d=>{
return d.dana===filterDana.value &&
(!tglAwal.value||d.tanggal>=tglAwal.value)&&
(!tglAkhir.value||d.tanggal<=tglAkhir.value);
});
if(!hasil.length)return alert('Data kosong');

let csv='Tanggal,Barang,Jenis,Jumlah,Dana,Keterangan\n';
hasil.forEach(d=>csv+=`${d.tanggal},${d.barang},${d.jenis},${d.jumlah},${d.dana},"${d.ket}"\n`);

let a=document.createElement('a');
let now=new Date().toISOString().slice(0,10);
a.href=URL.createObjectURL(new Blob([csv]));
a.download=`Inventaris_${filterDana.value}_${now}.csv`;
a.click();
}
</script>

</body>
</html>
