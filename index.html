<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris SKB Muara Badak</title>

<!-- XLSX -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
.hidden{display:none}
header{background:#1e40af;color:#fff;padding:12px;display:flex;align-items:center;justify-content:space-between}
header img{height:45px;margin-right:15px}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#e5e7eb}
input,select,button{padding:8px;margin:4px;width:100%}
button{cursor:pointer;border:none;border-radius:6px}
.primary{background:#2563eb;color:white}
.danger{background:#dc2626;color:white}
.success{background:#16a34a;color:white}
.menu{display:flex;gap:10px;flex-wrap:wrap}
#loginBox{max-width:420px;margin:60px auto;background:#fff;padding:30px;border-radius:12px;text-align:center}
#loginBox img{height:90px;margin-bottom:10px}
.logoutBtn{background:#f59e0b;color:white;padding:8px;border:none;border-radius:6px;cursor:pointer}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <img src="logo.png" alt="Logo SKB">
  <h3>Inventaris SKB Muara Badak</h3>
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button class="primary" id="loginBtn">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
  <div style="display:flex;align-items:center">
    <img src="logo.png">
    <h3>Dashboard Inventaris</h3>
  </div>
  <button class="logoutBtn" id="logoutBtn">Logout</button>
</header>

<div class="container">

<div class="card menu">
  <button class="primary" onclick="show('masuk')">Barang Masuk</button>
  <button class="danger" onclick="show('keluar')">Barang Keluar</button>
</div>

<!-- BARANG MASUK -->
<div class="card hidden" id="masuk">
<h3>Barang Masuk</h3>
<input id="mBarang" placeholder="Nama Barang">

<select id="mJenis">
  <option>Barang Modal</option>
  <option>BAJAS</option>
</select>

<select id="mDana">
  <option>BOSKAB 1</option>
  <option>BOSKAB 2</option>
  <option>BOP 1</option>
  <option>BOP 2</option>
  <option>Dana Lainnya</option>
</select>

<input type="number" id="mJumlah" placeholder="Jumlah">

<select id="mSatuan">
<option>rim</option><option>buah</option><option>pcs</option>
<option>pack</option><option>kotak</option><option>biji</option>
<option>set</option><option>lusin</option>
<option>Botol</option><option>Paket</option>
<option>Unit</option><option>Meter</option>
</select>

<button class="success" onclick="masukBarang()">Simpan</button>
</div>

<!-- BARANG KELUAR -->
<div class="card hidden" id="keluar">
<h3>Barang Keluar</h3>

<select id="kBarang"></select>
<input type="number" id="kJumlah" placeholder="Jumlah">

<select id="kSatuan">
<option>rim</option><option>buah</option><option>pcs</option>
<option>pack</option><option>kotak</option><option>biji</option>
<option>set</option><option>lusin</option>
<option>Botol</option><option>Paket</option>
<option>Unit</option><option>Meter</option>
</select>

<select id="kJenis"></select>
<select id="kDana"></select>

<select id="kAmbil">
<option>Bu Munawarah. S.Pd</option>
<option>Bu Liliana Sataria. S.Kom</option>
<option>Bu Fatimah. S.Pd</option>
<option>Bu Fitriyana. S.Pd</option>
<option>Bu Hirda Yulinalmi</option>
<option>Bu Dwi Rika. S.Pd</option>
<option>Bu Uut</option>
<option>Pak Heri Sadiman. S.Pd</option>
<option>Pak Jemidin. S.Pd., M.Pd</option>
<option>Pak Rehan</option>
<option>Pak Yu'an Reski Pongbanga. S.M</option>
<option>Bu Jumriana. S.Pd</option>
<option>Bu Devi Subhanatulaini. S.Pd</option>
<option>Bu Rusdiana. S.Pd</option>
</select>

<button class="danger" onclick="keluarBarang()">Simpan</button>
</div>

<!-- REKAP -->
<div class="card">
<h3>Rekap Stok (Per Barang)</h3>
<table id="rekap"></table>
</div>

<!-- DATA -->
<div class="card">
<h3>Data Inventaris</h3>
<table id="tabel"></table>
</div>

<!-- DOWNLOAD -->
<div class="card">
<h3>Download Excel</h3>

<select id="fTipe">
  <option value="">Semua</option>
  <option value="Masuk">Barang Masuk</option>
  <option value="Keluar">Barang Keluar</option>
</select>

<select id="fJenisDownload">
  <option value="">Semua Jenis</option>
</select>

<select id="fDanaDownload">
  <option value="">Semua Dana</option>
</select>

<button class="primary" onclick="downloadFilteredExcel()">Download Excel</button>
</div>

</div>
</div>

<script>
/* ======================
   DATA & LOGIN
====================== */
const akun=[
 {u:'admin',p:'123'},
 {u:'operator',p:'123'},
 {u:'rehan',p:'456'}
];

let data = JSON.parse(localStorage.getItem('inv')) || [];

/* ======================
   LOGIN
====================== */
loginBtn.onclick=()=>{
 let u=user.value, p=pass.value;
 if(!akun.find(a=>a.u===u&&a.p===p)) return alert('Login gagal');
 loginBox.style.display='none';
 app.classList.remove('hidden');
 updateAll();
}

logoutBtn.onclick=()=>{
 loginBox.style.display='block';
 app.classList.add('hidden');
 user.value=''; pass.value='';
}

function show(id){
 masuk.classList.add('hidden');
 keluar.classList.add('hidden');
 document.getElementById(id).classList.remove('hidden');
}

/* ======================
   STOK AKURAT
====================== */
function stok(barang,jenis,dana){
 let m=0,k=0;
 data.forEach(d=>{
  if(d.barang===barang && d.jenis===jenis && d.dana===dana){
    if(d.tipe==='Masuk') m+=d.jumlah;
    if(d.tipe==='Keluar') k+=d.jumlah;
  }
 });
 return m-k;
}

/* ======================
   BARANG MASUK
====================== */
function masukBarang(){
 let b=mBarang.value, j=mJenis.value, d=mDana.value;
 let q=+mJumlah.value, s=mSatuan.value;
 if(!b||!q) return alert('Lengkapi data');
 data.push({tipe:'Masuk',barang:b,jumlah:q,satuan:s,jenis:j,dana:d,pengambilan:''});
 localStorage.setItem('inv',JSON.stringify(data));
 mBarang.value=''; mJumlah.value='';
 updateAll();
}

/* ======================
   BARANG KELUAR
====================== */
function keluarBarang(){
 let b=kBarang.value, j=kJenis.value, d=kDana.value;
 let q=+kJumlah.value, s=kSatuan.value, p=kAmbil.value;
 if(q>stok(b,j,d)) return alert('Stok tidak cukup');
 data.push({tipe:'Keluar',barang:b,jumlah:q,satuan:s,jenis:j,dana:d,pengambilan:p});
 localStorage.setItem('inv',JSON.stringify(data));
 kJumlah.value='';
 updateAll();
}

/* ======================
   UPDATE UI
====================== */
function updateAll(){
 updateDropdown();
 updateRekap();
 updateTabel();
 updateDownloadOpt();
}

function updateDropdown(){
 kBarang.innerHTML='';
 kJenis.innerHTML='';
 kDana.innerHTML='';
 [...new Set(data.map(d=>d.barang))].forEach(v=>kBarang.innerHTML+=`<option>${v}</option>`);
 [...new Set(data.map(d=>d.jenis))].forEach(v=>kJenis.innerHTML+=`<option>${v}</option>`);
 [...new Set(data.map(d=>d.dana))].forEach(v=>kDana.innerHTML+=`<option>${v}</option>`);
}

function updateRekap(){
 let r='<tr><th>Barang</th><th>Jenis</th><th>Dana</th><th>Sisa</th></tr>';
 let map={};
 data.forEach(d=>{
  let k=d.barang+'|'+d.jenis+'|'+d.dana;
  if(!map[k]){
   map[k]=true;
   r+=`<tr>
     <td>${d.barang}</td>
     <td>${d.jenis}</td>
     <td>${d.dana}</td>
     <td>${stok(d.barang,d.jenis,d.dana)}</td>
   </tr>`;
  }
 });
 rekap.innerHTML=r;
}

function updateTabel(){
 let t='<tr><th>No</th><th>Tipe</th><th>Barang</th><th>Jumlah</th><th>Satuan</th><th>Jenis</th><th>Dana</th><th>Pengambilan</th></tr>';
 data.forEach((d,i)=>{
  t+=`<tr>
   <td>${i+1}</td>
   <td>${d.tipe}</td>
   <td>${d.barang}</td>
   <td>${d.jumlah}</td>
   <td>${d.satuan}</td>
   <td>${d.jenis}</td>
   <td>${d.dana}</td>
   <td>${d.pengambilan}</td>
  </tr>`;
 });
 tabel.innerHTML=t;
}

/* ======================
   DOWNLOAD EXCEL
====================== */
function updateDownloadOpt(){
 fJenisDownload.innerHTML='<option value="">Semua Jenis</option>';
 fDanaDownload.innerHTML='<option value="">Semua Dana</option>';
 [...new Set(data.map(d=>d.jenis))].forEach(v=>fJenisDownload.innerHTML+=`<option>${v}</option>`);
 [...new Set(data.map(d=>d.dana))].forEach(v=>fDanaDownload.innerHTML+=`<option>${v}</option>`);
}

function downloadFilteredExcel(){
 let t=fTipe.value, j=fJenisDownload.value, d=fDanaDownload.value;
 let f=data.filter(x=>
  (!t||x.tipe===t)&&(!j||x.jenis===j)&&(!d||x.dana===d)
 );
 if(!f.length) return alert('Data kosong');
 let ws=XLSX.utils.json_to_sheet(f);
 let wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,ws,'Inventaris');
 XLSX.writeFile(wb,'Inventaris_SKb.xlsx');
}

updateAll();
</script>

</body>
</html>
