<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris SKB Muara Badak</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{font-family:Segoe UI,Arial;background:#f1f5f9;margin:0}
.hidden{display:none}
header{background:#1e40af;color:white;padding:15px;display:flex;align-items:center;gap:15px}
header img{height:50px}
.card{background:white;margin:20px;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
.menu{display:flex;gap:10px;flex-wrap:wrap}
input,select,button{padding:10px;margin:6px 0;width:100%}
button{border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.primary{background:#2563eb;color:white}
.success{background:#16a34a;color:white}
.warn{background:#f59e0b;color:white}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#e5e7eb}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="card" style="max-width:420px;margin:100px auto;text-align:center">
<img src="logo.png" height="90"><br><br>
<h2>Inventaris SKB Muara Badak</h2>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button class="primary" onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
<img src="logo.png">
<h2>Dashboard Inventaris SKB Muara Badak</h2>
</header>

<div class="menu card">
<button class="primary" onclick="show('masuk')">游닌 Barang Masuk</button>
<button class="warn" onclick="show('keluar')">游닋 Barang Keluar</button>
<button class="success" onclick="show('rekap')">游늵 Rekap & Download</button>
</div>

<!-- BARANG MASUK -->
<div id="masuk" class="card hidden">
<h3>游닌 Barang Masuk</h3>
<input type="date" id="mTanggal">
<input id="mBarang" placeholder="Nama Barang">

<select id="mJenis">
<option value="">-- Pilih Jenis --</option>
<option>Barang Modal</option>
<option>BAJAS</option>
</select>

<select id="mSatuan">
<option value="">-- Pilih Satuan --</option>
<option>rim</option><option>buah</option><option>pcs</option>
<option>pack</option><option>kotak</option><option>biji</option><option>set</option>
</select>

<select id="mDana">
<option value="">-- Pilih Dana --</option>
<option>BOSKAB 1</option><option>BOSKAB 2</option>
<option>BOP 1</option><option>BOP 2</option>
<option>Dana Lainnya</option>
</select>

<input type="number" id="mJumlah" placeholder="Jumlah">
<button class="success" onclick="simpanMasuk()">Simpan</button>
</div>

<!-- BARANG KELUAR -->
<div id="keluar" class="card hidden">
<h3>游닋 Barang Keluar</h3>
<input type="date" id="kTanggal">

<select id="kBarang"></select>

<input type="number" id="kJumlah" placeholder="Jumlah">

<select id="kPengambil">
<option value="">-- Diambil Oleh --</option>
<option>Bu Munawarah. S.Pd</option>
<option>Bu Liliana Sataria. S.Kom</option>
<option>Bu Fatimah. S.Pd</option>
<option>Bu Fitriyana. S.Pd</option>
<option>Bu Hirda Yulinalmi</option>
<option>Bu Dwi Rika. S.Pd</option>
<option>Bu Uut</option>
<option>Pak Heri Sadiman. S.Pd</option>
<option>Pak Jemidin. S.Pd., M.Pd</option>
<option>Pak Rehan</option>
<option>Pak Yu'an Reski Pongbanga. S.M</option>
<option>Bu Jumriana. S.Pd</option>
<option>Bu Devi Subhanatulaini. S.Pd</option>
<option>Bu Rusdiana. S.Pd</option>
</select>

<button class="warn" onclick="simpanKeluar()">Simpan</button>
</div>

<!-- REKAP & DOWNLOAD -->
<div id="rekap" class="card hidden">
<h3>游늵 Rekap Stok Per Barang</h3>

<table>
<thead>
<tr>
<th>Barang</th><th>Jenis</th><th>Satuan</th>
<th>Masuk</th><th>Keluar</th><th>Sisa</th>
</tr>
</thead>
<tbody id="tblRekap"></tbody>
</table>

<hr>

<h3>游닌 Download Data (Filter)</h3>

<select id="fJenis">
<option value="">Semua Jenis</option>
<option>Barang Modal</option>
<option>BAJAS</option>
</select>

<select id="fDana">
<option value="">Semua Dana</option>
<option>BOSKAB 1</option><option>BOSKAB 2</option>
<option>BOP 1</option><option>BOP 2</option>
<option>Dana Lainnya</option>
</select>

<label>Tanggal Awal</label>
<input type="date" id="fAwal">

<label>Tanggal Akhir</label>
<input type="date" id="fAkhir">

<button class="primary" onclick="exportExcel()">游닌 Download Excel</button>
<button class="warn" onclick="backup()">游 Backup</button>
<input type="file" onchange="restore(event)">
</div>

</div>

<script>
const USERS={admin:'12345',operator:'123'};
let data=JSON.parse(localStorage.getItem('inv_skb'))||[];

function login(){
if(USERS[user.value]===pass.value){
loginBox.classList.add('hidden');
app.classList.remove('hidden');
refreshBarang();
}else alert('Login salah');
}

function show(id){
['masuk','keluar','rekap'].forEach(x=>document.getElementById(x).classList.add('hidden'));
document.getElementById(id).classList.remove('hidden');
if(id==='rekap') rekap();
}

function simpanMasuk(){
if(!mBarang.value||!mJenis.value||!mSatuan.value||!mDana.value||!mJumlah.value)
return alert('Lengkapi data');

data.push({
tanggal:mTanggal.value,
barang:mBarang.value,
jenis:mJenis.value,
satuan:mSatuan.value,
dana:mDana.value,
jumlah:+mJumlah.value,
tipe:'Masuk'
});
save();
}

function stok(b){
let m=0,k=0;
data.filter(d=>d.barang===b).forEach(d=>{
d.tipe==='Masuk'?m+=d.jumlah:k+=d.jumlah;
});
return m-k;
}

function simpanKeluar(){
let barang=kBarang.value;
if(kJumlah.value>stok(barang)) return alert('Stok tidak cukup');
let ref=data.find(d=>d.barang===barang && d.tipe==='Masuk');

data.push({
tanggal:kTanggal.value,
barang:barang,
jenis:ref.jenis,
satuan:ref.satuan,
dana:ref.dana,
jumlah:+kJumlah.value,
pengambil:kPengambil.value,
tipe:'Keluar'
});
save();
}

function save(){
localStorage.setItem('inv_skb',JSON.stringify(data));
refreshBarang();
}

function refreshBarang(){
kBarang.innerHTML='<option value="">-- Pilih Barang --</option>';
[...new Set(data.filter(d=>d.tipe==='Masuk').map(d=>d.barang))]
.forEach(b=>kBarang.innerHTML+=`<option>${b}</option>`);
}

function rekap(){
let map={};
tblRekap.innerHTML='';
data.forEach(d=>{
if(!map[d.barang]) map[d.barang]={barang:d.barang,jenis:d.jenis,satuan:d.satuan,masuk:0,keluar:0};
d.tipe==='Masuk'?map[d.barang].masuk+=d.jumlah:map[d.barang].keluar+=d.jumlah;
});
Object.values(map).forEach(r=>{
tblRekap.innerHTML+=`
<tr>
<td>${r.barang}</td><td>${r.jenis}</td><td>${r.satuan}</td>
<td>${r.masuk}</td><td>${r.keluar}</td><td><b>${r.masuk-r.keluar}</b></td>
</tr>`;
});
}

function exportExcel(){
let jenis=fJenis.value,dana=fDana.value,awal=fAwal.value,akhir=fAkhir.value;
let hasil=data.filter(d=>{
if(jenis && d.jenis!==jenis) return false;
if(dana && d.dana!==dana) return false;
if(awal && d.tanggal<awal) return false;
if(akhir && d.tanggal>akhir) return false;
return true;
});
if(!hasil.length) return alert('Data tidak ditemukan');

let ws=XLSX.utils.json_to_sheet(hasil);
let wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,'Inventaris');
XLSX.writeFile(wb,'Inventaris_SKB_Muara_Badak.xlsx');
}

function backup(){
let a=document.createElement('a');
a.href=URL.createObjectURL(new Blob([JSON.stringify(data)],{type:'application/json'}));
a.download='backup_inventaris.json';
a.click();
}

function restore(e){
let r=new FileReader();
r.onload=()=>{data=JSON.parse(r.result);save();};
r.readAsText(e.target.files[0]);
}
</script>

</body>
</html>
