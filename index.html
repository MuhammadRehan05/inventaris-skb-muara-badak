<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris SKB Muara Badak</title>

<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
.hidden{display:none}
header{background:#1e40af;color:white;padding:15px;display:flex;align-items:center}
.container{padding:20px}
.menu{display:flex;gap:15px;margin-bottom:20px;flex-wrap:wrap}
.menu button{padding:12px 18px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.masuk{background:#2563eb;color:white}
.keluar{background:#dc2626;color:white}
.card{background:white;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);margin-bottom:20px}
input,select,textarea{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc}
button.simpan{background:#16a34a;color:white;border:none;padding:10px;border-radius:6px;font-weight:bold;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#e5e7eb}

/* LOGIN */
#loginBox{
max-width:420px;margin:90px auto;background:white;padding:30px;
border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.15);text-align:center
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
<h2>Login Inventaris</h2>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button class="simpan" onclick="login()">Masuk</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
<h2>Dashboard Inventaris SKB Muara Badak</h2>
<div style="margin-left:auto" id="userInfo"></div>
</header>

<div class="container">

<!-- PILIH SUMBER DANA -->
<div class="card">
<h3>ðŸ’° Sumber Dana</h3>
<select id="danaSelect">
<option value="BOSKAB1">Dana BOSKAB 1</option>
<option value="BOSKAB2">Dana BOSKAB 2</option>
<option value="BOP1">Dana BOP 1</option>
<option value="BOP2">Dana BOP 2</option>
<option value="LAIN">Dana Lainnya</option>
</select>
</div>

<!-- RINGKASAN -->
<div class="menu">
<div class="card"><h3>Total Masuk</h3><h1 id="totalMasuk">0</h1></div>
<div class="card"><h3>Total Keluar</h3><h1 id="totalKeluar">0</h1></div>
<div class="card"><h3>Stok Total</h3><h1 id="stok">0</h1></div>
</div>

<div class="menu">
<button class="masuk" onclick="showForm('masuk')">âž• Barang Masuk</button>
<button class="keluar" onclick="showForm('keluar')">âž– Barang Keluar</button>
</div>

<!-- FORM MASUK -->
<div class="card hidden" id="formMasuk">
<h3>ðŸ“¥ Barang Masuk</h3>
<input type="date" id="tanggal">
<input id="mNama" placeholder="Nama Barang">
<input id="mJumlah" type="number" placeholder="Jumlah">
<textarea id="mKet" placeholder="Keterangan"></textarea>
<button class="simpan" onclick="simpanMasuk()">Simpan</button>
</div>

<!-- FORM KELUAR -->
<div class="card hidden" id="formKeluar">
<h3>ðŸ“¤ Barang Keluar</h3>
<input type="date" id="tanggalK">
<input id="kNama" placeholder="Nama Barang">
<input id="kJumlah" type="number" placeholder="Jumlah">
<select id="kAmbil">
<option value="">-- Diambil Oleh --</option>
<option>Bu Munawarah</option>
<option>Bu Liliana</option>
<option>Pak Jemidin</option>
<option>Pak Rehan</option>
</select>
<textarea id="kKet" placeholder="Keterangan"></textarea>
<button class="simpan" onclick="simpanKeluar()">Simpan</button>
</div>

<!-- DATA TRANSAKSI -->
<div class="card">
<h3>ðŸ“Š Data Inventaris</h3>
<table>
<thead>
<tr>
<th>No</th><th>Tanggal</th><th>Barang</th>
<th>Jenis</th><th>Jumlah</th><th>Sumber Dana</th><th>Keterangan</th>
</tr>
</thead>
<tbody id="tabel"></tbody>
</table>
</div>

<!-- SISA BARANG PER BARANG -->
<div class="card">
<h3>ðŸ“¦ Sisa Barang Per Barang</h3>
<table>
<thead>
<tr>
<th>Nama Barang</th>
<th>Total Masuk</th>
<th>Total Keluar</th>
<th>Sisa</th>
</tr>
</thead>
<tbody id="stokBarang"></tbody>
</table>
</div>

<button class="simpan" onclick="exportExcel()">ðŸ“¥ Export Excel</button>

</div>
</div>

<script>
/* MULTI USER */
const USERS=[
{user:'admin',pass:'12345',role:'Admin'},
{user:'operator',pass:'12345',role:'Operator'},
{user:'viewer',pass:'12345',role:'Viewer'}
];

let currentUser=null;
let data=[];

function getKey(){
 return 'inventaris_'+danaSelect.value;
}

function login(){
 let u=USERS.find(x=>x.user===user.value && x.pass===pass.value);
 if(!u) return alert('Login gagal');
 currentUser=u;
 loginBox.style.display='none';
 app.classList.remove('hidden');
 userInfo.innerText=u.user+' ('+u.role+')';
 loadData();
}

function loadData(){
 data=JSON.parse(localStorage.getItem(getKey()))||[];
 tampil();
}
danaSelect.onchange=loadData;

function showForm(j){
 formMasuk.classList.add('hidden');
 formKeluar.classList.add('hidden');
 if(j==='masuk') formMasuk.classList.remove('hidden');
 if(j==='keluar') formKeluar.classList.remove('hidden');
}

function simpanMasuk(){
 if(!tanggal.value||!mNama.value||mJumlah.value<=0)
  return alert('Data belum lengkap');

 data.push({
  tanggal:tanggal.value,
  barang:mNama.value,
  jenis:'Masuk',
  jumlah:+mJumlah.value,
  dana:danaSelect.value,
  ket:mKet.value
 });
 simpan();
}

function simpanKeluar(){
 if(!tanggalK.value||!kNama.value||kJumlah.value<=0||!kAmbil.value)
  return alert('Data belum lengkap');

 let stok=0;
 data.forEach(d=>{
  if(d.barang===kNama.value){
   if(d.jenis==='Masuk') stok+=d.jumlah;
   if(d.jenis==='Keluar') stok-=d.jumlah;
  }
 });
 if(kJumlah.value>stok) return alert('Stok tidak mencukupi');

 data.push({
  tanggal:tanggalK.value,
  barang:kNama.value,
  jenis:'Keluar',
  jumlah:+kJumlah.value,
  dana:danaSelect.value,
  ket:'Diambil oleh '+kAmbil.value+' | '+kKet.value
 });
 simpan();
}

function simpan(){
 localStorage.setItem(getKey(),JSON.stringify(data));
 tampil();
}

function tampil(){
 let html='', m=0, k=0;
 let stokMap={};

 data.forEach((d,i)=>{
  html+=`
  <tr>
   <td>${i+1}</td>
   <td>${new Date(d.tanggal).toLocaleDateString('id-ID')}</td>
   <td>${d.barang}</td>
   <td>${d.jenis}</td>
   <td>${d.jumlah}</td>
   <td>${danaSelect.options[danaSelect.selectedIndex].text}</td>
   <td>${d.ket}</td>
  </tr>`;

  if(!stokMap[d.barang]) stokMap[d.barang]={masuk:0,keluar:0};

  if(d.jenis==='Masuk'){ m+=d.jumlah; stokMap[d.barang].masuk+=d.jumlah; }
  if(d.jenis==='Keluar'){ k+=d.jumlah; stokMap[d.barang].keluar+=d.jumlah; }
 });

 tabel.innerHTML=html;
 totalMasuk.innerText=m;
 totalKeluar.innerText=k;
 stok.innerText=m-k;

 let sb='';
 for(let b in stokMap){
  sb+=`
  <tr>
   <td>${b}</td>
   <td>${stokMap[b].masuk}</td>
   <td>${stokMap[b].keluar}</td>
   <td>${stokMap[b].masuk-stokMap[b].keluar}</td>
  </tr>`;
 }
 stokBarang.innerHTML=sb;
}

function exportExcel(){
 let csv='No,Tanggal,Barang,Jenis,Jumlah,Sumber Dana,Keterangan\n';
 data.forEach((d,i)=>{
  csv+=`${i+1},${d.tanggal},${d.barang},${d.jenis},${d.jumlah},${danaSelect.value},"${d.ket}"\n`;
 });
 let a=document.createElement('a');
 a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
 a.download='Inventaris_'+danaSelect.value+'.csv';
 a.click();
}
</script>

</body>
</html>
