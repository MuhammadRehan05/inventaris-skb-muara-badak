<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris Barang SKB Muara Badak</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:20px;
}

h2{margin-top:30px}

table{
  width:100%;
  border-collapse:collapse;
  background:white;
}

th,td{
  border:1px solid #444;
  padding:6px;
  font-size:13px;
  text-align:center;
}

th{
  background:#a6c36f;
}

.subhead{
  background:#ddd;
  font-weight:bold;
}

.controls{
  margin:15px 0;
}

button,select{
  padding:8px 12px;
  font-size:14px;
}

@media print{
  @page{ size: landscape; }
  .controls{display:none}
}
</style>
</head>

<body>

<h2>Inventaris Barang (Padat)</h2>

<div class="controls">
  <select id="filterDana">
    <option value="">Semua Dana</option>
    <option value="BOP">BOP</option>
    <option value="BOSKAB">BOSKAB</option>
  </select>

  <select id="filterJenis">
    <option value="">Semua Jenis</option>
    <option value="MODAL">Barang Modal</option>
    <option value="BAJAS">BAJAS</option>
  </select>

  <button onclick="downloadExcel()">â¬‡ Download Excel</button>
  <button onclick="window.print()">ðŸ–¨ Cetak</button>
</div>

<table id="tabelInventaris">
<thead>
<tr>
  <th rowspan="2">Tanggal</th>
  <th rowspan="2">Nama Barang</th>
  <th colspan="3">Barang</th>
  <th rowspan="2">Pengambil</th>
  <th rowspan="2">Keterangan</th>
</tr>
<tr class="subhead">
  <th>Masuk</th>
  <th>Keluar</th>
  <th>Sisa</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
/* ===============================
   AMBIL DATA LAMA (JANGAN DIUBAH)
================================= */
const DATA_KEY = "inventarisData";

/* ===============================
   RENDER TABEL
================================= */
function renderTable(){
  const data = JSON.parse(localStorage.getItem(DATA_KEY)) || [];
  const tbody = document.querySelector("#tabelInventaris tbody");
  tbody.innerHTML = "";

  const dana = document.getElementById("filterDana").value;
  const jenis = document.getElementById("filterJenis").value;

  data.forEach(d=>{
    if(dana && !d.keterangan?.includes(dana)) return;
    if(jenis && !d.keterangan?.includes(jenis)) return;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d.tanggal || ""}</td>
      <td>${d.nama || ""}</td>
      <td>${d.masuk || ""}</td>
      <td>${d.keluar || ""}</td>
      <td>${d.sisa || ""}</td>
      <td>${d.pengambil || ""}</td>
      <td>${d.keterangan || ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById("filterDana").onchange = renderTable;
document.getElementById("filterJenis").onchange = renderTable;

/* ===============================
   DOWNLOAD EXCEL (1 SHEET)
================================= */
function downloadExcel(){
  const data = JSON.parse(localStorage.getItem(DATA_KEY)) || [];
  let rows = [
    ["Tanggal","Nama Barang","Masuk","Keluar","Sisa","Pengambil","Keterangan"]
  ];

  const dana = document.getElementById("filterDana").value;
  const jenis = document.getElementById("filterJenis").value;

  data.forEach(d=>{
    if(dana && !d.keterangan?.includes(dana)) return;
    if(jenis && !d.keterangan?.includes(jenis)) return;

    rows.push([
      d.tanggal||"",
      d.nama||"",
      d.masuk||"",
      d.keluar||"",
      d.sisa||"",
      d.pengambil||"",
      d.keterangan||""
    ]);
  });

  let csv = rows.map(r=>r.join("\t")).join("\n");
  let blob = new Blob([csv],{type:"application/vnd.ms-excel"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "inventaris.xlsx";
  a.click();
}

/* ===============================
   AUTO LOAD DATA LAMA
================================= */
document.addEventListener("DOMContentLoaded",renderTable);
</script>

</body>
</html>
