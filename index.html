<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris SKB Muara Badak</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
.hidden{display:none}
header{background:#1e40af;color:#fff;padding:12px;display:flex;align-items:center;justify-content:space-between}
header img{height:45px;margin-right:15px}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#e5e7eb}
input,select,button{padding:8px;margin:4px;width:100%}
button{cursor:pointer;border:none;border-radius:6px}
.primary{background:#2563eb;color:white}
.danger{background:#dc2626;color:white}
.success{background:#16a34a;color:white}
.menu{display:flex;gap:10px;flex-wrap:wrap}
#loginBox{max-width:420px;margin:40px auto;background:#fff;padding:30px;border-radius:12px;text-align:center}
#loginBox img{height:80px}
.logoutBtn{background:#f59e0b;color:white;padding:8px;border:none;border-radius:6px;cursor:pointer}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
<img src="logo.png" alt="Logo">
<h3>Inventaris SKB Muara Badak</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button class="primary" id="loginBtn">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
<div style="display:flex;align-items:center;">
<img src="logo.png" alt="Logo">
<h3>Dashboard Inventaris</h3>
</div>
<button class="logoutBtn" id="logoutBtn">Logout</button>
</header>

<div class="container">

<div class="card menu">
<button class="primary" onclick="show('masuk')">Barang Masuk</button>
<button class="danger" onclick="show('keluar')">Barang Keluar</button>
</div>

<!-- BARANG MASUK -->
<div class="card hidden" id="masuk">
<h3>Barang Masuk</h3>
<input id="mBarang" placeholder="Nama Barang">
<select id="mJenis">
<option>Barang Modal</option>
<option>BAJAS</option>
</select>
<select id="mDana">
<option>BOSKAB 1</option>
<option>BOSKAB 2</option>
<option>BOP 1</option>
<option>BOP 2</option>
<option>Dana Lainnya</option>
</select>
<input type="number" id="mJumlah" placeholder="Jumlah">
<select id="mSatuan">
<option>rim</option><option>buah</option><option>pcs</option>
<option>pack</option><option>kotak</option><option>biji</option>
<option>set</option><option>lusin</option>
<option>Botol</option><option>Paket</option><option>Unit</option><option>Meter</option>
</select>
<button class="success" onclick="masukBarang()">Simpan</button>
</div>

<!-- BARANG KELUAR -->
<div class="card hidden" id="keluar">
<h3>Barang Keluar</h3>
<select id="kBarang"></select>
<input type="number" id="kJumlah" placeholder="Jumlah">
<select id="kSatuan">
<option>rim</option><option>buah</option><option>pcs</option>
<option>pack</option><option>kotak</option><option>biji</option>
<option>set</option><option>lusin</option>
<option>Botol</option><option>Paket</option><option>Unit</option><option>Meter</option>
</select>
<select id="kJenis"></select>
<select id="kDana"></select>
<select id="kAmbil">
<option>Bu Munawarah. S.Pd</option>
<option>Bu Liliana Sataria. S.Kom</option>
<option>Bu Fatimah. S.Pd</option>
<option>Bu Fitriyana. S.Pd</option>
<option>Bu Hirda Yulinalmi</option>
<option>Bu Dwi Rika. S.Pd</option>
<option>Bu Uut</option>
<option>Pak Heri Sadiman. S.Pd</option>
<option>Pak Jemidin. S.Pd., M.Pd</option>
<option>Pak Rehan</option>
<option>Pak Yu'an Reski Pongbanga. S.M</option>
<option>Bu Jumriana. S.Pd</option>
<option>Bu Devi Subhanatulaini. S.Pd</option>
<option>Bu Rusdiana. S.Pd</option>
</select>
<button class="danger" onclick="keluarBarang()">Simpan</button>
</div>

<!-- REKAP -->
<div class="card">
<h3>Rekap & Stok</h3>
<table id="rekap"></table>
</div>

<!-- DATA -->
<div class="card">
<h3>Data Inventaris</h3>
<table id="tabel"></table>
</div>

<!-- DOWNLOAD -->
<div class="card">
<h3>Download Excel</h3>
<select id="fTipe">
<option value="">Semua Tipe</option>
<option value="Masuk">Barang Masuk</option>
<option value="Keluar">Barang Keluar</option>
</select>
<select id="fJenisDownload">
<option value="">Semua Jenis</option>
</select>
<select id="fDanaDownload">
<option value="">Semua Dana</option>
</select>
<button class="primary" onclick="downloadFilteredExcel()">Download Excel</button>
</div>

</div>
</div>

<script>
window.onload=function(){
const akun=[{u:'admin',p:'123'},{u:'operator',p:'123'},{u:'rehan',p:'456'}];
let data=JSON.parse(localStorage.getItem('inv'))||[];
const masuk=document.getElementById('masuk');
const keluar=document.getElementById('keluar');

document.getElementById('loginBtn').onclick=function(){
const u=document.getElementById('user').value;
const p=document.getElementById('pass').value;
if(!akun.find(a=>a.u===u && a.p===p)) return alert('Login gagal');
document.getElementById('loginBox').style.display='none';
document.getElementById('app').classList.remove('hidden');
updateDashboard();
updateDownloadOptions();
}

document.getElementById('logoutBtn').onclick=function(){
document.getElementById('loginBox').style.display='block';
document.getElementById('app').classList.add('hidden');
document.getElementById('user').value='';
document.getElementById('pass').value='';
}

window.show=function(id){
masuk.classList.add('hidden'); keluar.classList.add('hidden');
document.getElementById(id).classList.remove('hidden');
}

function stok(barang){
let masukTotal=0,keluarTotal=0;
data.forEach(d=>{
if(d.barang===barang && d.tipe==='Masuk') masukTotal+=d.jumlah;
if(d.barang===barang && d.tipe==='Keluar') keluarTotal+=d.jumlah;
});
return masukTotal-keluarTotal;
}

function updateDropdownKeluar(){
const kBarang=document.getElementById('kBarang');
const kJenis=document.getElementById('kJenis');
const kDana=document.getElementById('kDana');
kBarang.innerHTML=''; kJenis.innerHTML=''; kDana.innerHTML='';
const barangList=[...new Set(data.map(d=>d.barang))];
const jenisList=[...new Set(data.map(d=>d.jenis))];
const danaList=[...new Set(data.map(d=>d.dana))];
barangList.forEach(b=>kBarang.innerHTML+=`<option>${b}</option>`);
jenisList.forEach(j=>kJenis.innerHTML+=`<option>${j}</option>`);
danaList.forEach(d=>kDana.innerHTML+=`<option>${d}</option>`);
}

function updateDownloadOptions(){
const fJenis=document.getElementById('fJenisDownload');
const fDana=document.getElementById('fDanaDownload');
const tipeFilter=document.getElementById('fTipe').value;
let jenisList = [...new Set(data.filter(d=>!tipeFilter||d.tipe===tipeFilter).map(d=>d.jenis))];
let danaList = [...new Set(data.filter(d=>!tipeFilter||d.tipe===tipeFilter).map(d=>d.dana))];
fJenis.innerHTML='<option value="">Semua Jenis</option>';
fDana.innerHTML='<option value="">Semua Dana</option>';
jenisList.forEach(j=>fJenis.innerHTML+=`<option value="${j}">${j}</option>`);
danaList.forEach(d=>fDana.innerHTML+=`<option value="${d}">${d}</option>`);
}

window.masukBarang=function(){
const b=document.getElementById('mBarang').value;
const j=document.getElementById('mJenis').value;
const d=document.getElementById('mDana').value;
const q=document.getElementById('mJumlah').value;
const s=document.getElementById('mSatuan').value;
if(!b||!q||!j||!d) return alert('Lengkapi semua field!');
data.push({tipe:'Masuk',barang:b,jumlah:+q,satuan:s,jenis:j,dana:d,pengambilan:''});
localStorage.setItem('inv',JSON.stringify(data));
updateDashboard();
updateDownloadOptions();
document.getElementById('mBarang').value='';document.getElementById('mJumlah').value='';
}

window.keluarBarang=function(){
const b=document.getElementById('kBarang').value;
const q=document.getElementById('kJumlah').value;
const s=document.getElementById('kSatuan').value;
const j=document.getElementById('kJenis').value;
const d=document.getElementById('kDana').value;
const p=document.getElementById('kAmbil').value;
if(!q||!j||!d) return alert('Lengkapi semua field!');
if(q>stok(b)) return alert('Stok tidak cukup');
data.push({tipe:'Keluar',barang:b,jumlah:+q,satuan:s,jenis:j,dana:d,pengambilan:p});
localStorage.setItem('inv',JSON.stringify(data));
updateDashboard();
updateDownloadOptions();
document.getElementById('kJumlah').value='';
}

window.hapusData=function(i){
if(confirm('Hapus data?')){ data.splice(i,1); localStorage.setItem('inv',JSON.stringify(data)); updateDashboard(); updateDownloadOptions();}
}

function updateDashboard(){
updateDropdownKeluar();
let r='<tr><th>Barang</th><th>Sisa</th></tr>';
[...new Set(data.map(d=>d.barang))].forEach(b=>r+=`<tr><td>${b}</td><td>${stok(b)}</td></tr>`);
document.getElementById('rekap').innerHTML=r;

let t='<tr><th>No</th><th>Tipe</th><th>Barang</th><th>Jumlah</th><th>Satuan</th><th>Jenis</th><th>Dana</th><th>Pengambilan</th><th>Aksi</th></tr>';
data.forEach((d,i)=>{
t+=`<tr><td>${i+1}</td><td>${d.tipe}</td><td>${d.barang}</td><td>${d.jumlah}</td><td>${d.satuan}</td><td>${d.jenis}</td><td>${d.dana}</td><td>${d.pengambilan}</td><td><button class="danger" onclick="hapusData(${i})">Hapus</button></td></tr>`;
});
document.getElementById('tabel').innerHTML=t;
}

window.downloadFilteredExcel=function(){
const tipeFilter=document.getElementById('fTipe').value;
const jenisFilter=document.getElementById('fJenisDownload').value;
const danaFilter=document.getElementById('fDanaDownload').value;
let filtered=data.filter(d=>{
if(tipeFilter && d.tipe!==tipeFilter) return false;
if(jenisFilter && d.jenis!==jenisFilter) return false;
if(danaFilter && d.dana!==danaFilter) return false;
return true;
});
if(filtered.length===0) return alert('Data tidak ditemukan sesuai filter');
const ws=XLSX.utils.json_to_sheet(filtered, {header:["tipe","barang","jumlah","satuan","jenis","dana","pengambilan"]});
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,'Inventaris');
XLSX.writeFile(wb,'Inventaris_Filtered.xlsx');
}

document.getElementById('fTipe').onchange=updateDownloadOptions;

updateDashboard();
updateDownloadOptions();
}
</script>
</body>
</html>
