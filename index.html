<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris SKB Muara Badak</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
body{font-family:Arial;margin:0;background:#f1f5f9}
.hidden{display:none}
header{background:#1e40af;color:#fff;padding:12px;display:flex;align-items:center;justify-content:space-between}
header img{height:45px;margin-right:15px}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#e5e7eb}
input,select,button{padding:8px;margin:4px;width:100%}
button{cursor:pointer;border:none;border-radius:6px}
.primary{background:#2563eb;color:white}
.danger{background:#dc2626;color:white}
.success{background:#16a34a;color:white}
.menu{display:flex;gap:10px;flex-wrap:wrap}
#loginBox{max-width:420px;margin:40px auto;background:#fff;padding:30px;border-radius:12px;text-align:center}
#loginBox img{height:80px}
#loginInfo{margin-top:10px;text-align:left;font-size:14px;background:#f0f0f0;padding:10px;border-radius:8px}
.logoutBtn{background:#f59e0b;color:white;padding:8px;border:none;border-radius:6px;cursor:pointer}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
<img src="logo.png" alt="Logo">
<h3>Inventaris SKB Muara Badak</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button class="primary" id="loginBtn">Login</button>
<div id="loginInfo">
<strong>Username / Password Default:</strong>
<ul>
<li>admin / 123</li>
<li>operator / 123</li>
<li>rehan / 456</li>
</ul>
</div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
<div style="display:flex;align-items:center;">
<img src="logo.png" alt="Logo">
<h3>Dashboard Inventaris</h3>
</div>
<button class="logoutBtn" id="logoutBtn">Logout</button>
</header>

<div class="container">

<div class="card menu">
<button class="primary" onclick="show('masuk')">Barang Masuk</button>
<button class="danger" onclick="show('keluar')">Barang Keluar</button>
</div>

<!-- BARANG MASUK -->
<div class="card hidden" id="masuk">
<h3>Barang Masuk</h3>
<input type="date" id="mTanggal">
<input id="mBarang" placeholder="Nama Barang">
<select id="mJenis">
<option>Barang Modal</option>
<option>BAJAS</option>
</select>
<select id="mDana">
<option>BOSKAB 1</option>
<option>BOSKAB 2</option>
<option>BOP 1</option>
<option>BOP 2</option>
<option>Dana Lainnya</option>
</select>
<input type="number" id="mJumlah" placeholder="Jumlah">
<select id="mSatuan">
<option>rim</option><option>buah</option><option>pcs</option>
<option>pack</option><option>kotak</option><option>biji</option><option>set</option>
</select>
<button class="success" onclick="masukBarang()">Simpan</button>
</div>

<!-- BARANG KELUAR -->
<div class="card hidden" id="keluar">
<h3>Barang Keluar</h3>
<input type="date" id="kTanggal">
<select id="kBarang"></select>
<input type="number" id="kJumlah" placeholder="Jumlah">
<select id="kSatuan">
<option>rim</option><option>buah</option><option>pcs</option>
<option>pack</option><option>kotak</option><option>biji</option><option>set</option>
</select>
<select id="kAmbil">
<option>Bu Munawarah. S.Pd</option>
<option>Bu Liliana Sataria. S.Kom</option>
<option>Bu Fatimah. S.Pd</option>
<option>Bu Fitriyana. S.Pd</option>
<option>Bu Hirda Yulinalmi</option>
<option>Bu Dwi Rika. S.Pd</option>
<option>Bu Uut</option>
<option>Pak Heri Sadiman. S.Pd</option>
<option>Pak Jemidin. S.Pd., M.Pd</option>
<option>Pak Rehan</option>
<option>Pak Yu'an Reski Pongbanga. S.M</option>
<option>Bu Jumriana. S.Pd</option>
<option>Bu Devi Subhanatulaini. S.Pd</option>
<option>Bu Rusdiana. S.Pd</option>
</select>
<button class="danger" onclick="keluarBarang()">Simpan</button>
</div>

<!-- REKAP -->
<div class="card">
<h3>Rekap & Stok</h3>
<table id="rekap"></table>
</div>

<!-- DATA -->
<div class="card">
<h3>Data Inventaris</h3>
<table id="tabel"></table>
</div>

<!-- DOWNLOAD -->
<div class="card">
<h3>Download Excel</h3>
<select id="fJenis">
<option value="">Semua Jenis</option>
<option>Barang Modal</option>
<option>BAJAS</option>
</select>
<select id="fDana">
<option value="">Semua Dana</option>
<option>BOSKAB 1</option><option>BOSKAB 2</option>
<option>BOP 1</option><option>BOP 2</option>
<option>Dana Lainnya</option>
</select>
<input type="date" id="fAwal">
<input type="date" id="fAkhir">
<button class="primary" onclick="downloadExcel()">Download Excel</button>
</div>

</div>
</div>

<script>
window.onload = function() {
  const akun = [
    {u:'admin', p:'123', r:'admin'},
    {u:'operator', p:'123', r:'operator'},
    {u:'rehan', p:'456', r:'operator'}
  ];

  let data = JSON.parse(localStorage.getItem('inv')) || [];

  const masuk = document.getElementById('masuk');
  const keluar = document.getElementById('keluar');

  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  loginBtn.onclick = function() {
    const username = document.getElementById('user').value;
    const password = document.getElementById('pass').value;
    let a = akun.find(x => x.u === username && x.p === password);
    if(!a) return alert('Login gagal');
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('app').classList.remove('hidden');
    updateDashboard();
  };

  logoutBtn.onclick = function() {
    document.getElementById('loginBox').style.display = 'block';
    document.getElementById('app').classList.add('hidden');
    document.getElementById('user').value = '';
    document.getElementById('pass').value = '';
  };

  window.show = function(id) {
    masuk.classList.add('hidden');
    keluar.classList.add('hidden');
    document.getElementById(id).classList.remove('hidden');
  };

  window.masukBarang = function() {
    const tgl = document.getElementById('mTanggal').value;
    const barang = document.getElementById('mBarang').value;
    const jenis = document.getElementById('mJenis').value;
    const dana = document.getElementById('mDana').value;
    const jumlah = document.getElementById('mJumlah').value;
    const satuan = document.getElementById('mSatuan').value;
    if(!tgl || !barang || !jumlah) return alert('Lengkapi semua field!');
    data.push({tipe:'Masuk', tanggal:tgl, barang, jenis, dana, jumlah:+jumlah, satuan});
    localStorage.setItem('inv', JSON.stringify(data));
    updateDashboard();
  };

  window.keluarBarang = function() {
    const tgl = document.getElementById('kTanggal').value;
    const barang = document.getElementById('kBarang').value;
    const jumlah = document.getElementById('kJumlah').value;
    const satuan = document.getElementById('kSatuan').value;
    const ambil = document.getElementById('kAmbil').value;
    if(!tgl || !jumlah) return alert('Lengkapi semua field!');
    if(jumlah > stok(barang)) return alert('Stok tidak cukup');
    data.push({tipe:'Keluar', tanggal:tgl, barang, jumlah:+jumlah, satuan, ambil});
    localStorage.setItem('inv', JSON.stringify(data));
    updateDashboard();
  };

  function stok(barang) {
    let masukTotal = 0, keluarTotal = 0;
    data.forEach(d=>{
      if(d.barang === barang && d.tipe === 'Masuk') masukTotal += d.jumlah;
      if(d.barang === barang && d.tipe === 'Keluar') keluarTotal += d.jumlah;
    });
    return masukTotal - keluarTotal;
  }

  function updateDashboard() {
    const kBarang = document.getElementById('kBarang');
    kBarang.innerHTML = '';
    [...new Set(data.filter(d=>d.tipe==='Masuk').map(d=>d.barang))]
      .forEach(b => kBarang.innerHTML += `<option>${b}</option>`);

    let rekapHtml = '<tr><th>Barang</th><th>Sisa</th></tr>';
    [...new Set(data.map(d=>d.barang))].forEach(b => {
      rekapHtml += `<tr><td>${b}</td><td>${stok(b)}</td></tr>`;
    });
    document.getElementById('rekap').innerHTML = rekapHtml;

    let tabelHtml = '<tr><th>No</th><th>Tipe</th><th>Tanggal</th><th>Barang</th><th>Jumlah</th><th>Satuan</th><th>Aksi</th></tr>';
    data.forEach((d,i)=>{
      tabelHtml += `<tr>
        <td>${i+1}</td><td>${d.tipe}</td><td>${d.tanggal}</td>
        <td>${d.barang}</td><td>${d.jumlah}</td><td>${d.satuan||''}</td>
        <td><button class="danger" onclick="hapusData(${i})">Hapus</button></td>
      </tr>`;
    });
    document.getElementById('tabel').innerHTML = tabelHtml;
  }

  window.hapusData = function(i) {
    if(confirm('Hapus data?')) {
      data.splice(i,1);
      localStorage.setItem('inv', JSON.stringify(data));
      updateDashboard();
    }
  }

  window.downloadExcel = function() {
    const fJenis = document.getElementById('fJenis').value;
    const fDana = document.getElementById('fDana').value;
    const fAwal = document.getElementById('fAwal').value;
    const fAkhir = document.getElementById('fAkhir').value;
    const filtered = data.filter(d=>{
      if(fJenis && d.jenis!==fJenis) return false;
      if(fDana && d.dana!==fDana) return false;
      if(fAwal && d.tanggal<fAwal) return false;
      if(fAkhir && d.tanggal>fAkhir) return false;
      return true;
    });
    const ws = XLSX.utils.json_to_sheet(filtered);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Inventaris');
    XLSX.writeFile(wb,'Inventaris_SKB.xlsx');
  };

  updateDashboard();
}
</script>
</body>
</html>
