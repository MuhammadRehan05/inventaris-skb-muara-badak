<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Inventaris SKB Muara Badak</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0 }
header { text-align:center; padding:20px; background:#fff }
header img { height:80px }
h2 { margin:10px 0 }

table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  background:#fff;
}

th, td {
  border:1px solid #555;
  padding:6px;
  font-size:13px;
  text-align:center;
}

th {
  background:#9cc35d;
  color:#000;
  font-weight:bold;
}

.subhead {
  background:#ddd;
  font-weight:bold;
}

.controls {
  padding:15px;
  background:#fff;
  margin-top:10px;
}

select, button {
  padding:6px 10px;
  margin-right:5px;
}

@media print {
  @page { size: landscape; }
  button, select { display:none }
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Logo SKB">
  <h2>Inventaris Barang SKB Muara Badak</h2>
</header>

<div class="controls">
  <b>Download Excel:</b>
  <select id="filterDana">
    <option value="">Semua Dana</option>
    <option>BOSKAB</option>
    <option>BOP</option>
  </select>

  <select id="filterJenis">
    <option value="">Semua Jenis</option>
    <option>Barang Modal</option>
    <option>BAJAS</option>
  </select>

  <button onclick="downloadExcel()">â¬‡ Download Excel</button>
</div>

<table id="tabel">
<thead>
<tr>
  <th rowspan="2">Tanggal</th>
  <th rowspan="2">Nama Barang</th>
  <th colspan="3">Barang</th>
  <th rowspan="2">Pengambil</th>
  <th rowspan="2">Keterangan</th>
</tr>
<tr class="subhead">
  <th>Masuk</th>
  <th>Keluar</th>
  <th>Sisa</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// ================= JANGAN UBAH BAGIAN INI =================
function ambilDataLama() {
  const kandidatKey = [
    'data',
    'inventaris',
    'inventarisData',
    'barangMasuk',
    'barangKeluar',
    'stokData'
  ];

  let hasil = [];

  kandidatKey.forEach(k => {
    const isi = localStorage.getItem(k);
    if (isi) {
      try {
        const parsed = JSON.parse(isi);
        if (Array.isArray(parsed)) {
          hasil = hasil.concat(parsed);
        }
      } catch (e) {}
    }
  });

  return hasil;
}
// ==========================================================

let data = ambilDataLama();

function render() {
  const tbody = document.querySelector("#tabel tbody");
  tbody.innerHTML = "";

  let stok = {};

  data.forEach(d => {
    if (!stok[d.nama]) stok[d.nama] = 0;
    stok[d.nama] += (d.masuk || 0) - (d.keluar || 0);

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d.tanggal || ''}</td>
      <td>${d.nama || ''}</td>
      <td>${d.masuk || ''}</td>
      <td>${d.keluar || ''}</td>
      <td>${stok[d.nama]}</td>
      <td>${d.pengambil || ''}</td>
      <td>${d.keterangan || ''}</td>
    `;
    tbody.appendChild(tr);
  });
}

function downloadExcel() {
  let csv = "Tanggal,Nama Barang,Masuk,Keluar,Sisa,Pengambil,Keterangan\n";
  let stok = {};

  data.forEach(d => {
    if (!stok[d.nama]) stok[d.nama] = 0;
    stok[d.nama] += (d.masuk || 0) - (d.keluar || 0);

    csv += [
      d.tanggal,
      d.nama,
      d.masuk || '',
      d.keluar || '',
      stok[d.nama],
      d.pengambil || '',
      d.keterangan || ''
    ].join(",") + "\n";
  });

  const blob = new Blob([csv], { type:"text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "inventaris_skb.csv";
  a.click();
}

render();
</script>

</body>
</html>
